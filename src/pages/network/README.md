# 网络
## 从输入URL到页面加载完成的过程
<img align='center' src="../../static/imgs/url-analyse.png" />

1. 首先是从URL中解析出域名进行DNS查询，如果这一步做了智能DNS解析的话，会提供访问速度最快的IP地址回来，否则需要一级一级进行查询，从跟服务器、一级域名、二级域名依次进行查询;

2. 浏览器端的所有请求本质都是`HTTP`请求，底层都是`TCP/IP`协议，浏览器根据请求返回的`Content-type`来决定如何解析数据;

3. 接下来是`TCP`握手，应用层会下发数据给传输层，这里`TCP`协议会指明两端的端口号，然后下发给网络层。网络层中的`IP`协议会确定`IP`地址，并且指示了数据传输中如何跳转路由器。然后包会再被封装到数据链路层的数据帧结构中，最后就是物理层面的传输了

4. `TCP`握手结束后会进行`TLS`握手，然后就开始正式的传输数据;

5. 数据在进入服务端之前，可能还会先经过负责负载均衡的服务器，它的作用就是将请求合理的分发到多台服务器上，这时假设服务端会响应一个`HTML`文件;

6. 首先浏览器会判断状态码是什么，如果是200那就继续解析，如果400或500的话就会报错，如果300的话会进行重定向，这里会有个重定向计数器，避免过多次的重定向，超过次数也会报错;

7. 浏览器开始解析文件，如果是`gzip`格式的话会先解压一下，然后通过文件的编码格式知道该如何去解码文件;

8. 文件解码成功后会正式开始渲染流程，先会根据`HTML`构建`DOM`树，有`CSS`的话会去构建`CSSOM`树。如果遇到`script`标签的话，会判断是否存在`async`或者`defer` ，前者会并行进行下载并执行JS（不会操作DOM），后者会先下载文件，然后等待`HTML`解析完成后顺序执行，如果以上都没有，就会阻塞住渲染流程直到JS执行完毕。遇到文件下载的会去下载文件，这里如果使用`HTTP 2.0`协议的话会极大的提高多图的下载效率。

9. 初始的`HTML`被完全加载和解析后会触发`DOMContentLoaded`事件;

10. `CSSOM`树和`DOM`树构建完成后会开始生成`Render`树，这一步就是确定页面元素的布局、样式等等诸多方面的东西;

11. 在生成`Render`树的过程中，浏览器就开始调用`GPU`绘制，合成图层，将内容显示在屏幕上了;

## OSI 概念模型
- OSI(`Open System Interconnection Reference Model`)
1. 应用层，如HTTP等协议，解决的是业务问题
2. 表示层，主要是把网络中的消息转换成应用层可以读取的消息
3. 会话层，建立回话、握手、关闭
4. 传输层，进程与进程之间的通讯
5. 网络层，把报文从一个主机上发送到另外一个主机上，就是现在的`Internet`
6. 数据链路层，在局域网中使用Mac地址连接到相应的交换机或者路由器把报文转到另一个主机上
7. 物理层，物理的介质

## HTTP
### 什么是HTTP协议？
- `HTTP`是一种无状态的、应用层的、以请求/应答方式运行的协议，它使用可扩展的语义和字描述消息格式，与基于网络的超文本信息系统灵活的互动

### HTTP解决了什么问题
1. 低门槛
2. 可扩展性：巨大的用户群体，超长的寿命
3. 分布式系统下的`Hypermedia`: 大粒度数据的网络传输(视频、音乐等)
4. `Internet`规模
---
* 无法控制的`scalability`
> 不可预测的负载、非法格式的数据、恶意消息 
> 客户端不能保持所有服务器信息，服务器不能保持多个请求间的状态信息
* 独立的组件部署：新老组件并存

5. 向前兼容：自1993年起HTTP0.9/1.0(1996)已经被广泛使用

### HTTP常见方法
- `GET` 主要的获取信息的方法，大量的性能优化都针对该方法，幂等方法
- `HEAD` 类似`GET`的方法，但服务器不发送`BODY`，用于获取`HEAD`元数据，幂等方法
- `POST` 常用于`HTML FORM`表单提交，新增资源
- `PUT` 更新资源，带条件时是幂等方法
- `DELETE` 删除资源，幂等方法
- `CONNECT` 建立`tunnel`隧道
- `OPTIONS` 显示服务器对访问资源支持的方法，幂等方法
- `TRACE` 回显服务器接收到的请求，用于定位问题，有安全风险
<p><font color='red'><b>什么是幂等方法：就是调用一次和调用多次的结果是一样的</b></font></p>

### 响应码规范
#### `1xx` 请求已接收到，需要进一步处理才能完成，`HTTP1.0`不支持
- `100 Continue`：上传大文件前使用
> 由客户端发起请求中携带 Expect: 100-continue 头部触发
- `101 Switch Protocols`: 协议升级使用
> 由客户端发起请求中携带 Upgrade: 头部触发，如升级 websocket 或者 http/2.0
- `102 Processing` WebDAV 请求可能包含许多涉及文件操作的子请求，需要很长时间才能完成请求，该代码表示服务器已经收到并正在处理请求，但无响应可用，这样可以防止客户端超时，并假设请求丢失

#### `2xx` 成功处理请求
- `200 OK` 成功返回响应
- `201 Created` 有新资源在服务器端被成功创建
- `202 Accepted` 服务器接收并开始处理请求，但请求未处理完成
> 例如异步、需要长时间处理的任务
- `203 Non-Authoritative Information` 当代理服务器修改了`origin server`的原始响应包体时(例如奉还了HTML中的元素值)
> 代理服务器可以通过修改200为203的方式告知客户端这一事实，方便客户端为这一行为作出相应的处理，203响应可以被缓存


## HTTP2.0

## HTTPS

## TLS/SSL

## TCP

## IP

## 应用常见问题

### 为什么要进行URI编码
- 传递数据中，如果存在用作分隔符的保留字符怎么办？

- 对可能产生歧义性的数据编码
1. 不在ASCII码范围内的字符
2. ASCII码中不可显示的字符
3. URI中规定的保留字符`: / ? # [ ] @ ! $ & ' ( ) * + , ; =`等等
4. 不安全字符(传输环节中可能被不正确的处理)，如：空格、引号、尖括号等
